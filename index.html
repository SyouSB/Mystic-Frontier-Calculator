<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="keywords" content="ÎØ∏Ïä§Ìã± ÌîÑÎ°†Ìã∞Ïñ¥, Mystic Frontier">

  <title>ÎØ∏Ïä§Ìã± ÌîÑÎ°†Ìã∞Ïñ¥ Í≥ÑÏÇ∞Í∏∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg-color: #0f172a;
      --card-bg: #1e293b;
      --accent-primary: #3b82f6;
      --accent-secondary: #facc15;
      --text-main: #f8fafc;
      --text-muted: #94a3b8;
      --success: #10b981;
      --danger: #ef4444;
    }

    body { 
      font-family: 'Pretendard', -apple-system, sans-serif; 
      background: var(--bg-color); 
      color: var(--text-main);
      margin: 0; 
      padding: 20px; 
      line-height: 1.6;
    }

    .container { 
      max-width: 700px; 
      margin: auto; 
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding: 0 10px;
    }

    h1 { font-size: 22px; margin: 0; color: var(--accent-secondary); text-shadow: 0 0 10px rgba(250, 204, 21, 0.3); }

    .card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    h2 { font-size: 16px; color: var(--text-muted); margin-top: 0; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
    h2::before { content: ''; display: inline-block; width: 4px; height: 16px; background: var(--accent-primary); border-radius: 2px; }

    .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
    
    input { 
      background: #334155;
      border: 1px solid #475569;
      color: white;
      padding: 12px; 
      border-radius: 8px; 
      width: 100%; 
      box-sizing: border-box;
      transition: all 0.2s;
      font-size: 16px;
    }
    input:focus { outline: none; border-color: var(--accent-primary); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); }
    input::placeholder { color: #64748b; font-size: 14px; }

    .option-row { 
      display: flex; 
      gap: 8px; 
      margin-bottom: 10px; 
      align-items: center;
      padding: 10px;
      border-radius: 10px;
      background: rgba(15, 23, 42, 0.5);
    }
    .option-row input.condition { flex: 2; }
    .option-row input { flex: 1; }

    button.calc-btn { 
      width: 100%;
      padding: 16px; 
      border: none; 
      border-radius: 12px; 
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      color: #fff; 
      font-size: 18px; 
      font-weight: bold;
      cursor: pointer; 
      transition: transform 0.1s, box-shadow 0.2s;
      margin: 20px 0;
    }
    button.calc-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(37, 99, 235, 0.4); }
    button.calc-btn:active { transform: translateY(0); }

    .lang-btn {
      background: transparent;
      border: 1px solid var(--text-muted);
      color: var(--text-muted);
      padding: 4px 12px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 12px;
    }

    .formula-visual {
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 25px;
      background: #0f172a;
      border-radius: 14px;
      margin-top: 10px;
      border: 1px dashed #334155;
    }
    .formula-box { text-align: center; }
    .formula-label { font-size: 12px; color: var(--text-muted); margin-bottom: 5px; }
    .formula-val { font-size: 24px; font-weight: 800; color: var(--accent-secondary); }
    .operator { font-size: 20px; color: var(--text-muted); font-weight: 300; }

    .final-card {
      text-align: center;
      padding: 30px;
      background: linear-gradient(145deg, #1e293b, #0f172a);
    }
    .result-score { font-size: 48px; font-weight: 900; margin: 10px 0; color: white; }
    .winlose-badge {
      display: inline-block;
      padding: 8px 24px;
      border-radius: 50px;
      font-weight: bold;
      font-size: 20px;
      margin-top: 10px;
    }
    .win { background: rgba(16, 185, 129, 0.2); color: var(--success); border: 1px solid var(--success); }
    .lose { background: rgba(239, 68, 68, 0.2); color: var(--danger); border: 1px solid var(--danger); }
    .draw { background: rgba(148, 163, 184, 0.2); color: var(--text-muted); border: 1px solid var(--text-muted); }

    .status-dot { font-size: 11px; padding: 2px 8px; border-radius: 4px; display: none; }
    .status-dot.active { display: inline-block; background: var(--success); color: white; }
    .status-dot.inactive { display: inline-block; background: #475569; color: white; }

    .option-row.inactive-result input, .option-row.inactive-result .status-dot { opacity: 0.5; filter: grayscale(0.8); }
    .option-row.active { border-left: 4px solid var(--success); background: rgba(16, 185, 129, 0.05); }

    .familiar-group .option-row {
      display: grid;
      grid-template-columns: auto 2.2fr 0.5fr 0.5fr 50px; 
      gap: 8px;
    }

    #extraOptions .option-row input {
      flex: 1;
    }

    .familiar-group .option-row input {
      width: 100% !important;
      padding: 10px 4px;
      font-size: 13px;
    }

    /*
    .clear-btn {
      background: #475569;
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    .clear-btn:hover { background: var(--danger); }
    */

    .clear-btn {
      background: var(--danger); 
      color: white;
      border: none;
      border-radius: 6px; 
      width: 28px; 
      height: 28px;
      cursor: pointer;
      font-size: 16px; 
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: all 0.2s;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); 
    }

    .clear-btn:hover {
      background: #b91c1c; 
      transform: scale(1.05); 
    }

    .clear-btn:active {
      transform: scale(0.95); 
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    /* ÌîÑÎ¶¨ÏÖã */
    .modal-content {
      background: white;
      width: 90%;
      max-width: 400px;
      border-radius: 20px;
      padding: 20px;
      color: #333;
      box-shadow: 0 20px 25px -5px rgba(0,0,0,0.5);
    }

    .modal-header {
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      margin-bottom: 20px;
    }

    .modal-header h3 {
      margin: 0;
      font-size: 18px;
      color: #000;
    }

    .close-x {
      position: absolute;
      right: 0;
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #999;
    }

    .modal-body {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .modal-item-btn:hover {
      background: #f8fafc;
      border-color: var(--accent-primary);
    }

    .modal-item-btn.active {
      border: 2px solid var(--accent-primary);
      color: var(--accent-primary);
      font-weight: bold;
    }    

    .preset-row {
      display: flex;
      gap: 8px;
      align-items: center;
      width: 100%;
    }

    .modal-item-btn {
      flex: 1;
      padding: 15px;
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      font-size: 16px;
      color: #333;
      text-align: left;
      cursor: pointer;
    }

    .edit-name-btn {
      width: 45px;
      height: 45px;
      background: #f1f5f9;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      transition: all 0.2s;
    }

    .edit-name-btn:hover {
      background: #e2e8f0;
    }
  </style>
</head>
<body>
  <div class="container">
    <header style="display: flex; flex-direction: column; gap: 15px; margin-bottom: 25px;">
      <div class="header-top" style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
        <h1 id="title" style="font-size: 20px;">üé≤ ÎØ∏Ïä§Ìã± ÌîÑÎ°†Ìã∞Ïñ¥ Í≥ÑÏÇ∞Í∏∞</h1>
        <div style="display: flex; gap: 6px;">
          <button onclick="resetCurrentPreset()" class="lang-btn" style="border-color: var(--danger); color: var(--danger);">Reset</button>
          <button onclick="toggleLang()" id="langBtn" class="lang-btn">EN</button>
        </div>
      </div>

      <button onclick="openPresetModal()" class="calc-btn" style="margin: 0; padding: 12px; font-size: 15px; background: #334155; border: 1px solid #475569;">
        üìÅ <span id="currentPresetName">ÌîÑÎ¶¨ÏÖã 1 ÏÑ†ÌÉùÎê®</span>
      </button>
    </header>

    <div id="presetModal" class="modal-overlay" onclick="closePresetModal(event)">
      <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
          <h3 id="modalTitle">Î∂àÎü¨Ïò¨ ÌîÑÎ¶¨ÏÖãÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</h3>
          <button class="close-x" onclick="closePresetModal()">√ó</button>
        </div>
        <div class="modal-body" id="presetList">
          </div>
      </div>
    </div>

    <div class="card">
      <h2 id="h-diffculty">ÎÇúÏù¥ÎèÑ</h2>
      <input type="number" id="diffcultyDice" placeholder="ÎÇúÏù¥ÎèÑ Í∞í" />
    </div>

    <div class="card">
      <h2 id="h-mydice">ÎÇ¥ Ï£ºÏÇ¨ÏúÑ Í≤∞Í≥º (1~6)</h2>
      <div class="grid">
        <input type="number" min="1" max="6" id="dice1" placeholder="D1" />
        <input type="number" min="1" max="6" id="dice2" placeholder="D2" />
        <input type="number" min="1" max="6" id="dice3" placeholder="D3" />
      </div>
    </div>

    <div class="card">
      <h2 style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
          <div>
            <span id="h-familiar">ÌçºÎ∞Ä ÏòµÏÖò (Ï°∞Í±¥ ÎØ∏ÏûÖÎ†• Ïãú ÏÉÅÏãúÏ†ÅÏö©)</span>
          </div>
          <button type="button" class="clear-btn" onclick="resetSection('specialOptions')" style="margin-left: auto; width: auto; padding: 0 10px; font-size: 12px;">Reset</button>
        </h2>      
      <datalist id="conditionList">
        <option value="If the first die rolls an odd number">
        <option value="If the second die rolls an odd number">
        <option value="If the third die rolls an odd number">
        <option value="If the first die rolls an even number">
        <option value="If the second die rolls an even number">
        <option value="If the third die rolls an even number">
        <option value="If the first and second dice add up to 2 or more">
        <option value="If the first and second dice add up to 4 or more">
        <option value="If the first and second dice add up to 6 or more">
        <option value="If the first and third dice add up to 2 or more">
        <option value="If the first and third dice add up to 4 or more">
        <option value="If the first and third dice add up to 6 or more">
        <option value="If the second and third dice add up to 2 or more">
        <option value="If the second and third dice add up to 4 or more">
        <option value="If the second and third dice add up to 6 or more">
        <option value="If all three dice add up to 2 or more">
        <option value="If all three dice add up to 3 or more">
        <option value="If all three dice add up to 5 or more">                    
        <option value="If the first and second dice match">
        <option value="If the first and third dice match">
        <option value="If the second and third dice match">
        <option value="If all three dice roll a 1">
        <option value="If all three dice roll a 2">
        <option value="If all three dice roll a 3">
        <option value="If all three dice roll a 4">
        <option value="If all three dice roll a 5">
        <option value="If all three dice roll a 6">
        <option value="If the three dice roll consecutive numbers">
      </datalist>
      <div id="specialOptions" class="familiar-group">
        <div class="option-row">
          <button type="button" class="clear-btn" onclick="clearRow(this)">√ó</button>
          <input class="condition" list="conditionList" placeholder="Ï°∞Í±¥ ÏÑ†ÌÉù (ÏÑ†ÌÉùÏÇ¨Ìï≠)" onfocus="this.select()"/>
          <input type="number" placeholder="+ / -" class="special-add" />
          <input type="number" step="0.1" placeholder="Î∞∞Ïú®" class="special-mul" />
          <span class="status-dot"></span>
        </div>
        <div class="option-row">
          <button type="button" class="clear-btn" onclick="clearRow(this)">√ó</button>
          <input class="condition" list="conditionList" placeholder="Ï°∞Í±¥ ÏÑ†ÌÉù (ÏÑ†ÌÉùÏÇ¨Ìï≠)" onfocus="this.select()"/>
          <input type="number" placeholder="+ / -" class="special-add" />
          <input type="number" step="0.1" placeholder="Î∞∞Ïú®" class="special-mul" />
          <span class="status-dot"></span>
        </div>
        <div class="option-row">
          <button type="button" class="clear-btn" onclick="clearRow(this)">√ó</button>
          <input class="condition" list="conditionList" placeholder="Ï°∞Í±¥ ÏÑ†ÌÉù (ÏÑ†ÌÉùÏÇ¨Ìï≠)" onfocus="this.select()"/>
          <input type="number" placeholder="+ / -" class="special-add" />
          <input type="number" step="0.1" placeholder="Î∞∞Ïú®" class="special-mul" />
          <span class="status-dot"></span>
        </div>
      </div>
    </div>

    <div class="card">
      <h2 style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
        <span id="h-item">ÏïÑÏù¥ÌÖú ÏòµÏÖò</span>
        <button type="button" class="clear-btn" onclick="resetSection('extraOptions')" style="margin-left: auto; width: auto; padding: 0 10px; font-size: 12px;">Reset</button>
      </h2>
      
      <div id="extraOptions">
        <div class="option-row"><input type="number" placeholder="+ / -" class="extra-add" /><input type="number" step="0.1" placeholder="Î∞∞Ïú®" class="extra-mul" /></div>
        <div class="option-row"><input type="number" placeholder="+ / -" class="extra-add" /><input type="number" step="0.1" placeholder="Î∞∞Ïú®" class="extra-mul" /></div>
        <div class="option-row"><input type="number" placeholder="+ / -" class="extra-add" /><input type="number" step="0.1" placeholder="Î∞∞Ïú®" class="extra-mul" /></div>
        <div class="option-row"><input type="number" placeholder="+ / -" class="extra-add" /><input type="number" step="0.1" placeholder="Î∞∞Ïú®" class="extra-mul" /></div>
        <div class="option-row"><input type="number" placeholder="+ / -" class="extra-add" /><input type="number" step="0.1" placeholder="Î∞∞Ïú®" class="extra-mul" /></div>
      </div>
    </div>

    <button class="calc-btn" id="calcBtn" onclick="calculate(true)">Í≤∞Í≥º ÌôïÏù∏ÌïòÍ∏∞</button>

    <div id="resultSection" style="display:none; margin-bottom: 50px;">
      <div class="card">
        <h2 id="h-formula">ÏÉÅÏÑ∏ Í≥ÑÏÇ∞Ïãù</h2>
          <div class="formula-visual">
            <div class="formula-box">
              <div class="formula-label" id="lbl-formula-add">+ / -</div>
              <div class="formula-val" id="fAdd">0</div>
            </div>
            <div class="operator">+</div>
            <div class="formula-box">
              <div class="formula-label" id="lbl-formula-base">Ï£ºÏÇ¨ÏúÑ Ìï©</div>
              <div class="formula-val" id="fBase">0</div>
            </div>
            <div class="operator">√ó</div>
            <div class="formula-box">
              <div class="formula-label" id="lbl-formula-mul">Î∞∞Ïú®</div>
              <div class="formula-val" id="fMul">1</div>
            </div>
          </div>
        </div>
      <div class="card final-card">
        <h2 id="h-result" style="justify-content: center;">Í≤∞Í≥º</h2>
        <div class="result-score" id="result">0</div>
        <div id="winlose" class="winlose-badge">Î¨¥ÏäπÎ∂Ä</div>
        <p id="alwaysNote" style="font-size:12px; color:var(--text-muted); margin-top:15px; display:none;"></p>
      </div>
    </div>
  </div>

  <script>
    function toggleLang() {
      const isKo = document.documentElement.lang === 'ko';
      const newLang = isKo ? 'en' : 'ko';
      document.documentElement.lang = newLang;

      const trans = {
        title: newLang === 'ko' ? 'üé≤ ÎØ∏Ïä§Ìã± ÌîÑÎ°†Ìã∞Ïñ¥ Í≥ÑÏÇ∞Í∏∞' : 'üé≤ Mystic Frontier Calculator',
        langBtn: newLang === 'ko' ? 'EN' : 'KO',
        h_diffculty: newLang === 'ko' ? 'ÎÇúÏù¥ÎèÑ' : 'Difficulty',
        h_mydice: newLang === 'ko' ? 'ÎÇ¥ Ï£ºÏÇ¨ÏúÑ Í≤∞Í≥º (1~6)' : 'My Dice Results (1~6)',
        h_familiar: newLang === 'ko' ? 'ÌçºÎ∞Ä ÏòµÏÖò (Ï°∞Í±¥ ÎØ∏ÏûÖÎ†• Ïãú ÏÉÅÏãúÏ†ÅÏö©)' : 'Familiar Options (Always applied if empty)',
        h_item: newLang === 'ko' ? 'ÏïÑÏù¥ÌÖú ÏòµÏÖò' : 'Item Options',
        h_formula: newLang === 'ko' ? 'ÏÉÅÏÑ∏ Í≥ÑÏÇ∞Ïãù' : 'Calculation Detail',
        h_result: newLang === 'ko' ? 'Í≤∞Í≥º' : 'Result',
        h_formula: newLang === 'ko' ? 'ÏÉÅÏÑ∏ Í≥ÑÏÇ∞Ïãù' : 'Calculation Detail',
        lbl_f_add: '+ / -', 
        lbl_f_base: newLang === 'ko' ? 'Ï£ºÏÇ¨ÏúÑ Ìï©' : 'Dice Sum',
        lbl_f_mul: newLang === 'ko' ? 'Î∞∞Ïú®' : 'Multiplier',
        calcBtn: newLang === 'ko' ? 'Í≤∞Í≥º ÌôïÏù∏ÌïòÍ∏∞' : 'Calculate',
        
        // Placeholder Îç∞Ïù¥ÌÑ∞
        ph_diff: newLang === 'ko' ? 'ÎÇúÏù¥ÎèÑ Í∞í' : 'Difficulty Value',
        ph_cond: newLang === 'ko' ? 'Ï°∞Í±¥ ÏÑ†ÌÉù (ÏÑ†ÌÉùÏÇ¨Ìï≠)' : 'Select condition (Optional)',
        ph_add: '+ / -',
        ph_mul: newLang === 'ko' ? 'Î∞∞Ïú®' : 'Multiplier'
      };

      document.getElementById('title').innerText = trans.title;
      document.getElementById('langBtn').innerText = trans.langBtn;
      document.getElementById('h-diffculty').innerText = trans.h_diffculty;
      document.getElementById('h-mydice').innerText = trans.h_mydice;
      document.getElementById('h-familiar').innerText = trans.h_familiar;
      document.getElementById('h-item').innerText = trans.h_item;
      document.getElementById('h-formula').innerText = trans.h_formula;
      document.getElementById('h-result').innerText = trans.h_result;
      document.getElementById('calcBtn').innerText = trans.calcBtn;
      document.getElementById('h-formula').innerText = trans.h_formula;
      document.getElementById('lbl-formula-add').innerText = trans.lbl_f_add;
      document.getElementById('lbl-formula-base').innerText = trans.lbl_f_base;
      document.getElementById('lbl-formula-mul').innerText = trans.lbl_f_mul;

      document.getElementById('diffcultyDice').placeholder = trans.ph_diff;
      
      document.querySelectorAll('.condition').forEach(el => {
        el.placeholder = trans.ph_cond;
      });
      
      document.querySelectorAll('.special-add, .extra-add').forEach(el => {
        el.placeholder = trans.ph_add;
      });
      
      document.querySelectorAll('.special-mul, .extra-mul').forEach(el => {
        el.placeholder = trans.ph_mul;
      });
      
      if(document.getElementById('resultSection').style.display !== 'none') calculate();
    }

    function calculate(shouldScroll = false) {
      document.getElementById('resultSection').style.display = 'block';

      const d1 = Number(document.getElementById('dice1').value) || 0;
      const d2 = Number(document.getElementById('dice2').value) || 0;
      const d3 = Number(document.getElementById('dice3').value) || 0;
      const diffculty = Number(document.getElementById('diffcultyDice').value) || 0;

      let baseSum = d1 + d2 + d3;
      let addSum = 0;
      let mulSum = 0;
      let hasAlwaysOn = false;

      document.querySelectorAll('#specialOptions .option-row').forEach(row => {
        const c = row.querySelector('.condition').value.trim();
        let conditionMet = false;

        if (c === '') { if(row.querySelector('.special-add').value || row.querySelector('.special-mul').value) { conditionMet = true; hasAlwaysOn = true; } }
        else {
            // Ïä§Ìä∏Î†àÏù¥Ìä∏
            if (c === 'If the three dice roll consecutive numbers') {
                const arr = [d1,d2,d3].sort((a,b)=>a-b);
                conditionMet = (arr[0]!==0) && (arr[1] === arr[0] + 1 && arr[2] === arr[1] + 1);
            }

            // ÌôÄÏàò
            if (c === 'If the first die rolls an odd number' && d1 % 2 === 1) conditionMet = true;
            if (c === 'If the second die rolls an odd number' && d2 % 2 === 1) conditionMet = true;
            if (c === 'If the third die rolls an odd number' && d3 % 2 === 1) conditionMet = true;

            // ÏßùÏàò
            if (c === 'If the first die rolls an even number' && d1 % 2 === 0 && d1 !== 0) conditionMet = true;
            if (c === 'If the second die rolls an even number' && d2 % 2 === 0 && d2 !== 0) conditionMet = true;
            if (c === 'If the third die rolls an even number' && d3 % 2 === 0 && d3 !== 0) conditionMet = true;

            // add up
            if (c === 'If the first and second dice add up to 2 or more' && d1 >= 2 && d2 >= 2) conditionMet = true;
            if (c === 'If the first and second dice add up to 4 or more' && d1 >= 4 && d2 >= 4) conditionMet = true;
            if (c === 'If the first and second dice add up to 6 or more' && d1 >= 6 && d2 >= 6) conditionMet = true;

            if (c === 'If the first and third dice add up to 2 or more' && d1 >= 2 && d3 >= 2) conditionMet = true;
            if (c === 'If the first and third dice add up to 4 or more' && d1 >= 4 && d3 >= 4) conditionMet = true;
            if (c === 'If the first and third dice add up to 6 or more' && d1 >= 6 && d3 >= 6) conditionMet = true;

            if (c === 'If the second and third dice add up to 2 or more' && d2 >= 2 && d3 >= 2) conditionMet = true;
            if (c === 'If the second and third dice add up to 4 or more' && d2 >= 4 && d3 >= 4) conditionMet = true;
            if (c === 'If the second and third dice add up to 6 or more' && d2 >= 6 && d3 >= 6) conditionMet = true;

            if (c === 'If all three dice add up to 2 or more' && d1 >= 2 && d2 >= 2 && d3 >= 2) conditionMet = true;
            if (c === 'If all three dice add up to 3 or more' && d1 >= 3 && d2 >= 3 && d3 >= 3) conditionMet = true;
            if (c === 'If all three dice add up to 5 or more' && d1 >= 5 && d2 >= 5 && d3 >= 5) conditionMet = true;
            
            // match
            if (c === 'If the first and second dice match' && d1 === d2) conditionMet = true;
            if (c === 'If the first and third dice match' && d1 === d3) conditionMet = true;
            if (c === 'If the second and third dice match' && d2 === d3) conditionMet = true;

            // Yacht
            if (c === 'If all three dice roll a 1' && d1 === 1 && d2 === 1 && d3 === 1) conditionMet = true;
            if (c === 'If all three dice roll a 2' && d1 === 2 && d2 === 2 && d3 === 2) conditionMet = true;
            if (c === 'If all three dice roll a 3' && d1 === 3 && d2 === 3 && d3 === 3) conditionMet = true;
            if (c === 'If all three dice roll a 4' && d1 === 4 && d2 === 4 && d3 === 4) conditionMet = true;
            if (c === 'If all three dice roll a 5' && d1 === 5 && d2 === 5 && d3 === 5) conditionMet = true;
            if (c === 'If all three dice roll a 6' && d1 === 6 && d2 === 6 && d3 === 6) conditionMet = true;
        }

        const st = row.querySelector('.status-dot');
        const currentLang = document.documentElement.lang;

        if (conditionMet) {
          row.classList.add('active');
          row.classList.remove('inactive-result');
          st.innerText = currentLang === 'ko' ? 'Ï†ÅÏö©Îê®' : 'Applied';
          st.className = 'status-dot active';
          addSum += Number(row.querySelector('.special-add').value) || 0;
          mulSum += Number(row.querySelector('.special-mul').value) || 0;
        } else {
          row.classList.add('inactive-result');
          row.classList.remove('active');
          st.innerText = currentLang === 'ko' ? 'ÎØ∏Ï†ÅÏö©' : 'Not Applied';
          st.className = 'status-dot inactive';
        }
      });

      document.querySelectorAll('.extra-add').forEach(i => addSum += Number(i.value) || 0);
      document.querySelectorAll('.extra-mul').forEach(i => mulSum += Number(i.value) || 0);

      const multiplier = mulSum > 0 ? mulSum : 1;
      const finalValue = (addSum + baseSum) * multiplier;
      
      document.getElementById('result').innerText = Math.floor(finalValue);
      document.getElementById('fAdd').innerText = addSum;
      document.getElementById('fBase').innerText = baseSum;
      document.getElementById('fMul').innerText = multiplier.toFixed(1);

      const wlBadge = document.getElementById('winlose');
      if (finalValue > diffculty) {
        wlBadge.innerText = document.documentElement.lang === 'ko' ? 'ÏäπÎ¶¨' : 'WIN';
        wlBadge.className = 'winlose-badge win';
      } else if (finalValue < diffculty) {
        wlBadge.innerText = document.documentElement.lang === 'ko' ? 'Ìå®Î∞∞' : 'LOSE';
        wlBadge.className = 'winlose-badge lose';
      } else {
        wlBadge.innerText = document.documentElement.lang === 'ko' ? 'Î¨¥ÏäπÎ∂Ä' : 'DRAW';
        wlBadge.className = 'winlose-badge draw';
      }

      // Í≤∞Í≥ºÏ∞ΩÏúºÎ°ú Ïä§ÌÅ¨Î°§
      if (shouldScroll) {
        setTimeout(() => {
          resultSection.scrollIntoView({ 
            behavior: 'smooth', 
          block: 'start' 
          });
        }, 50);
      }
    }

  // Ï¥àÍ∏∞Ìôî Î≤ÑÌäº
  function clearRow(btn) {
    const row = btn.parentElement;
    
    row.querySelectorAll('input').forEach(input => {
      input.value = '';
    });
    
    const st = row.querySelector('.status-dot');
    st.innerText = '';
    st.className = 'status-dot';
    row.classList.remove('active', 'inactive-result');
  }

  let currentPreset = 1;
  let currentGroup = 'A'; // A: 1-3, B: 4-6

  let presetNames = JSON.parse(localStorage.getItem('mysticPresetNames')) || {
    1: "Preset 1", 2: "Preset 2", 3: "Preset 3", 
    4: "Preset 4", 5: "Preset 5", 6: "Preset 6"
  };

  function openPresetModal() {
  const modal = document.getElementById('presetModal');
  modal.style.display = 'flex';
  renderModalPresets();
  }

  function closePresetModal(event) {
    document.getElementById('presetModal').style.display = 'none';
  }

  // ÌîÑÎ¶¨ÏÖã Î™©Î°ù
  function renderModalPresets() {
    const list = document.getElementById('presetList');
    const currentLang = document.documentElement.lang;
    list.innerHTML = '';

    for (let i = 1; i <= 6; i++) {
      const row = document.createElement('div');
      row.className = 'preset-row';

      const selectBtn = document.createElement('button');
      selectBtn.className = `modal-item-btn ${currentPreset === i ? 'active' : ''}`;
      selectBtn.innerText = presetNames[i];
      selectBtn.onclick = () => {
        selectPreset(i);
        closePresetModal();
      };

      const editBtn = document.createElement('button');
      editBtn.className = 'edit-name-btn';
      editBtn.innerHTML = '‚úèÔ∏è';
      editBtn.onclick = (e) => {
        e.stopPropagation();
        editPresetName(i);
      };

      row.appendChild(selectBtn);
      row.appendChild(editBtn);
      list.appendChild(row);
    }

    document.getElementById('modalTitle').innerText = 
      currentLang === 'ko' ? 'Î∂àÎü¨Ïò¨ ÌîÑÎ¶¨ÏÖãÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî' : 'Select a preset to load';    
  }

  // Ïù¥Î¶Ñ ÏàòÏ†ï
  function editPresetName(idx) {
    const currentLang = document.documentElement.lang;
    const messages = {
        ko: "ÏÉàÎ°úÏö¥ ÌîÑÎ¶¨ÏÖã Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:",
        en: "Enter a new name for this preset:"
      };    
    const newName = prompt(messages[currentLang], presetNames[idx]);

    if (newName && newName.trim() !== "") {
      presetNames[idx] = newName.trim();
      localStorage.setItem('mysticPresetNames', JSON.stringify(presetNames));
      
      renderModalPresets();
      if (currentPreset === idx) {
        document.getElementById('currentPresetName').innerText = newName;
      }
    }
  }

  // ÌîÑÎ¶¨ÏÖã ÏÑ†ÌÉù
  function selectPreset(idx) {
    currentPreset = idx;
    document.getElementById('currentPresetName').innerText = presetNames[idx];
    loadData();
    localStorage.setItem('mysticFrontier_LastPreset', idx);
  }

  window.addEventListener('load', () => {
    const last = localStorage.getItem('mysticFrontier_LastPreset') || 1;
    selectPreset(parseInt(last));

    document.querySelectorAll('input').forEach(input => {
      input.addEventListener('input', saveData);
    });
  });
    
  // ÌîÑÎ¶¨ÏÖã Î™©Î°ù
  function renderPresetOptions() {
    const select = document.getElementById('presetSelect');
    const start = currentGroup === 'A' ? 1 : 4;
    select.innerHTML = '';
    
    for (let i = start; i < start + 3; i++) {
      const opt = document.createElement('option');
      opt.value = i;
      opt.innerText = `Preset ${i}`;
      if (i === currentPreset) opt.selected = true;
      select.appendChild(opt);
    }
  }

  // ÌîÑÎ¶¨ÏÖã Î≥ÄÍ≤Ω
  function changePreset(idx) {
    currentPreset = idx;
    document.getElementById('presetSelect').value = idx; // Select Í∞í ÎèôÍ∏∞Ìôî
    loadData();
  }

  // Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• 
  function saveData() {
    const data = {
      difficulty: document.getElementById('diffcultyDice').value,
      dice: [
        document.getElementById('dice1').value,
        document.getElementById('dice2').value,
        document.getElementById('dice3').value
      ],
      specialOptions: Array.from(document.querySelectorAll('#specialOptions .option-row')).map(row => ({
        condition: row.querySelector('.condition').value,
        add: row.querySelector('.special-add').value,
        mul: row.querySelector('.special-mul').value
      })),
      extraOptions: Array.from(document.querySelectorAll('#extraOptions .option-row')).map(row => ({
        add: row.querySelector('.extra-add').value,
        mul: row.querySelector('.extra-mul').value
      })),
      lang: document.documentElement.lang
    };
    
    localStorage.setItem(`mysticFrontierData_${currentPreset}`, JSON.stringify(data));
    localStorage.setItem('mysticFrontier_LastPreset', currentPreset); // ÎßàÏßÄÎßâ ÏÇ¨Ïö© ÌîÑÎ¶¨ÏÖã Í∏∞Ïñµ
  }

  // Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞
  function loadData() {
    const saved = localStorage.getItem(`mysticFrontierData_${currentPreset}`);
    
    if (!saved) {
      resetAllInputs();
      return;
    }

    const data = JSON.parse(saved);

    document.getElementById('diffcultyDice').value = data.difficulty || '';
    document.getElementById('dice1').value = data.dice[0] || '';
    document.getElementById('dice2').value = data.dice[1] || '';
    document.getElementById('dice3').value = data.dice[2] || '';

    const specialRows = document.querySelectorAll('#specialOptions .option-row');
    data.specialOptions.forEach((opt, i) => {
      if (specialRows[i]) {
        specialRows[i].querySelector('.condition').value = opt.condition || '';
        specialRows[i].querySelector('.special-add').value = opt.add || '';
        specialRows[i].querySelector('.special-mul').value = opt.mul || '';
      }
    });

    const extraRows = document.querySelectorAll('#extraOptions .option-row');
    data.extraOptions.forEach((opt, i) => {
      if (extraRows[i]) {
        extraRows[i].querySelector('.extra-add').value = opt.add || '';
        extraRows[i].querySelector('.extra-mul').value = opt.mul || '';
      }
    });

    calculate();
  }

  // ÌîÑÎ¶¨ÏÖã Ï¥àÍ∏∞Ìôî
  function resetCurrentPreset() {
    const currentLang = document.documentElement.lang;
    const currentPName = presetNames[currentPreset]; 
    const msg = currentLang === 'ko' 
      ? `ÌòÑÏû¨ ÌîÑÎ¶¨ÏÖã(${currentPName})Ïùò Î™®Îì† Îç∞Ïù¥ÌÑ∞Î•º Ï¥àÍ∏∞ÌôîÌï†ÍπåÏöî?` 
      : `Reset all data for Preset ${currentPName}?`;

    if (confirm(msg)) {
      localStorage.removeItem(`mysticFrontierData_${currentPreset}`);
      const defaultName = currentLang === 'ko' ? `ÌîÑÎ¶¨ÏÖã ${currentPreset}` : `Preset ${currentPreset}`;
      presetNames[currentPreset] = defaultName;
      localStorage.setItem('mysticPresetNames', JSON.stringify(presetNames));
      document.getElementById('currentPresetName').innerText = defaultName;
      resetAllInputs();
      loadData(true);
      document.getElementById('resultSection').style.display = 'none';
    }
  }

  // ÏûÖÎ†•Ï∞Ω Ï¥àÍ∏∞Ìôî
  function resetAllInputs() {
    document.querySelectorAll('input').forEach(input => input.value = '');
    document.querySelectorAll('.status-dot').forEach(dot => {
      dot.innerText = '';
      dot.className = 'status-dot';
    });
    document.querySelectorAll('.option-row').forEach(row => row.classList.remove('active', 'inactive-result'));
    document.getElementById('resultSection').style.display = 'none';
  }

  // Ï¥àÍ∏∞ Î°úÎìú
  window.addEventListener('load', () => {
    const lastPreset = localStorage.getItem('mysticFrontier_LastPreset');
    changePreset(lastPreset ? parseInt(lastPreset) : 1);

    document.querySelectorAll('input').forEach(input => {
      input.addEventListener('input', saveData);
    });
  });

  // ÏÑπÏÖòÎ≥Ñ Ï¥àÍ∏∞Ìôî
  function resetSection(sectionId) {
    const currentLang = document.documentElement.lang;
    const sectionName = sectionId === 'specialOptions' 
      ? (currentLang === 'ko' ? "ÌçºÎ∞Ä ÏòµÏÖò" : "Familiar Options")
      : (currentLang === 'ko' ? "ÏïÑÏù¥ÌÖú ÏòµÏÖò" : "Item Options");

    const msg = currentLang === 'ko' 
      ? `${sectionName}Ïùò Î™®Îì† ÎÇ¥Ïö©ÏùÑ ÏÇ≠Ï†úÌï†ÍπåÏöî?` 
      : `Clear all ${sectionName}?`;

    if (confirm(msg)) {
      const container = document.getElementById(sectionId);
      
      container.querySelectorAll('input').forEach(input => input.value = '');
      
      if (sectionId === 'specialOptions') {
        container.querySelectorAll('.status-dot').forEach(dot => {
          dot.innerText = '';
          dot.className = 'status-dot';
        });
        container.querySelectorAll('.option-row').forEach(row => {
          row.classList.remove('active', 'inactive-result');
        });
      }

      saveData();
      if (document.getElementById('resultSection').style.display !== 'none') calculate();
    }
  } 
  </script>
</body>
</html>

